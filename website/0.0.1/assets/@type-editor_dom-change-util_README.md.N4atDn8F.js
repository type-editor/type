import{_ as s,o as a,c as t,ak as i}from"./chunks/framework.EVMbD_FN.js";const k=JSON.parse('{"title":"@type-editor/dom-change-util","description":"","frontmatter":{},"headers":[],"relativePath":"@type-editor/dom-change-util/README.md","filePath":"@type-editor/dom-change-util/README.md"}'),n={name:"@type-editor/dom-change-util/README.md"};function r(p,e,d,h,l,o){return a(),t("div",null,[...e[0]||(e[0]=[i(`<p><a href="./../../README.html"><strong>Type Editor</strong></a></p><hr><p><a href="./../../">Type Editor</a> / @type-editor/dom-change-util</p><h1 id="type-editor-dom-change-util" tabindex="-1">@type-editor/dom-change-util <a class="header-anchor" href="#type-editor-dom-change-util" aria-label="Permalink to “@type-editor/dom-change-util”">​</a></h1><p>This module was part of the <code>ProseMirror view module</code>.</p><p>DOM mutation detection and processing utilities for Type Editor. This module handles reading changes from the DOM and converting them into editor transactions.</p><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to “Installation”">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @type-editor/dom-change-util</span></span></code></pre></div><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to “Overview”">​</a></h2><p>This module provides the core functionality for detecting and processing DOM mutations in a content-editable editor. It bridges the gap between browser DOM changes and the Type Editor&#39;s document model, handling various browser-specific quirks and edge cases.</p><h3 id="key-responsibilities" tabindex="-1">Key Responsibilities <a class="header-anchor" href="#key-responsibilities" aria-label="Permalink to “Key Responsibilities”">​</a></h3><ul><li><strong>Parse DOM changes</strong> and convert them to document changes</li><li><strong>Handle browser-specific quirks</strong> (Chrome, Safari, IE11, Android, iOS)</li><li><strong>Detect and optimize mark changes</strong> (bold, italic, etc.)</li><li><strong>Manage selection reconstruction</strong> after DOM mutations</li><li><strong>Handle composition events</strong> and IME input</li></ul><h2 id="api" tabindex="-1">API <a class="header-anchor" href="#api" aria-label="Permalink to “API”">​</a></h2><h3 id="readdomchange" tabindex="-1"><code>readDOMChange</code> <a class="header-anchor" href="#readdomchange" aria-label="Permalink to “readDOMChange”">​</a></h3><p>The main entry point for processing DOM mutations. Reads changes from the DOM and converts them into editor transactions.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { readDOMChange } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/dom-change-util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readDOMChange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view, from, to, typeOver, addedNodes);</span></span></code></pre></div><h4 id="parameters" tabindex="-1">Parameters <a class="header-anchor" href="#parameters" aria-label="Permalink to “Parameters”">​</a></h4><table tabindex="0"><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>view</code></td><td><code>EditorView</code></td><td>The editor view containing the DOM and document state</td></tr><tr><td><code>from</code></td><td><code>number</code></td><td>Start position of the change. Negative values indicate selection-only changes</td></tr><tr><td><code>to</code></td><td><code>number</code></td><td>End position of the change</td></tr><tr><td><code>typeOver</code></td><td><code>boolean</code></td><td>Whether this change is part of typing over an active selection</td></tr><tr><td><code>addedNodes</code></td><td><code>ReadonlyArray&lt;Node&gt;</code></td><td>DOM nodes added during the mutation</td></tr></tbody></table><h3 id="processing-pipeline" tabindex="-1">Processing Pipeline <a class="header-anchor" href="#processing-pipeline" aria-label="Permalink to “Processing Pipeline”">​</a></h3><ol><li><strong>Selection-only changes</strong>: When <code>from &lt; 0</code>, handles pure selection updates without content changes</li><li><strong>Range adjustment</strong>: Expands the change range to block boundaries for accurate parsing</li><li><strong>DOM parsing</strong>: Parses the changed DOM range into a document representation</li><li><strong>Diff detection</strong>: Compares parsed content with the current document to find differences</li><li><strong>Browser adjustments</strong>: Applies browser-specific fixes and workarounds</li><li><strong>Transaction dispatch</strong>: Creates and dispatches appropriate transactions</li></ol><h2 id="browser-compatibility" tabindex="-1">Browser Compatibility <a class="header-anchor" href="#browser-compatibility" aria-label="Permalink to “Browser Compatibility”">​</a></h2><p>The module includes specific handling for:</p><table tabindex="0"><thead><tr><th>Browser</th><th>Special Handling</th></tr></thead><tbody><tr><td><strong>Chrome</strong></td><td>Backspace behavior, composition deletion quirks</td></tr><tr><td><strong>Safari/iOS</strong></td><td>Enter key detection, selection timing</td></tr><tr><td><strong>IE11</strong></td><td>Non-breaking space insertion, selection positioning</td></tr><tr><td><strong>Android</strong></td><td>Enter-and-pick-suggestion action, virtual keyboard quirks</td></tr><tr><td><strong>Edge</strong></td><td>Cursor advancement in empty blocks</td></tr></tbody></table><h2 id="types" tabindex="-1">Types <a class="header-anchor" href="#types" aria-label="Permalink to “Types”">​</a></h2><h3 id="documentchange" tabindex="-1"><code>DocumentChange</code> <a class="header-anchor" href="#documentchange" aria-label="Permalink to “DocumentChange”">​</a></h3><p>Represents a detected change in the document.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DocumentChange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** Start position of the change */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** End position in the old document */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  endA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** End position in the new document */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  endB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="parsebetweenresult" tabindex="-1"><code>ParseBetweenResult</code> <a class="header-anchor" href="#parsebetweenresult" aria-label="Permalink to “ParseBetweenResult”">​</a></h3><p>Result of parsing a DOM range into a document.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ParseBetweenResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** Parsed document node */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  doc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** Reconstructed selection (anchor/head positions) */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  sel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">anchor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">head</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** Start position where parsing began */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  from</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** End position where parsing ended */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  to</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="internal-structure" tabindex="-1">Internal Structure <a class="header-anchor" href="#internal-structure" aria-label="Permalink to “Internal Structure”">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>src/</span></span>
<span class="line"><span>├── index.ts                    # Package exports</span></span>
<span class="line"><span>└── dom-change/</span></span>
<span class="line"><span>    ├── read-dom-change.ts      # Main entry point</span></span>
<span class="line"><span>    ├── constants.ts            # Shared constants</span></span>
<span class="line"><span>    ├── browser-hacks/          # Browser-specific workarounds</span></span>
<span class="line"><span>    │   ├── is-android-enter-suggestion-quirk.ts</span></span>
<span class="line"><span>    │   ├── is-ie11-non-breaking-space-bug.ts</span></span>
<span class="line"><span>    │   ├── should-handle-mobile-enter-key.ts</span></span>
<span class="line"><span>    │   └── ...</span></span>
<span class="line"><span>    ├── parse-change/           # Change detection and parsing</span></span>
<span class="line"><span>    │   ├── find-diff.ts</span></span>
<span class="line"><span>    │   ├── parse-between.ts</span></span>
<span class="line"><span>    │   ├── is-mark-change.ts</span></span>
<span class="line"><span>    │   ├── looks-like-enter-key.ts</span></span>
<span class="line"><span>    │   ├── looks-like-backspace-key.ts</span></span>
<span class="line"><span>    │   └── ...</span></span>
<span class="line"><span>    ├── types/                  # Type definitions</span></span>
<span class="line"><span>    │   └── dom-change/</span></span>
<span class="line"><span>    │       ├── DocumentChange.ts</span></span>
<span class="line"><span>    │       ├── ParseBetweenResult.ts</span></span>
<span class="line"><span>    │       └── ...</span></span>
<span class="line"><span>    └── util/                   # Helper utilities</span></span></code></pre></div><h2 id="notes" tabindex="-1">Notes <a class="header-anchor" href="#notes" aria-label="Permalink to “Notes”">​</a></h2><p>All referencing and parsing is done with the start-of-operation selection and document, since that&#39;s what the DOM represents. If any changes came in the meantime, the modification is mapped over those before it is applied.</p><h2 id="license" tabindex="-1">License <a class="header-anchor" href="#license" aria-label="Permalink to “License”">​</a></h2><p>MIT</p><h2 id="modules" tabindex="-1">Modules <a class="header-anchor" href="#modules" aria-label="Permalink to “Modules”">​</a></h2><table><thead><tr><th>Module</th><th>Description</th></tr></thead><tbody><tr><td><p><a href="./browser-hacks/adjust-for-chrome-backspace-bug/README.html">browser-hacks/adjust-for-chrome-backspace-bug</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./browser-hacks/handle-br-node-rule/README.html">browser-hacks/handle-br-node-rule</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./browser-hacks/is-android-enter-suggestion-quirk/README.html">browser-hacks/is-android-enter-suggestion-quirk</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./browser-hacks/is-ie11-non-breaking-space-bug/README.html">browser-hacks/is-ie11-non-breaking-space-bug</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./browser-hacks/looks-likes-enter-key-ios/README.html">browser-hacks/looks-likes-enter-key-ios</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./browser-hacks/should-handle-android-enter-key/README.html">browser-hacks/should-handle-android-enter-key</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./browser-hacks/should-handle-mobile-enter-key/README.html">browser-hacks/should-handle-mobile-enter-key</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./browser-hacks/should-suppress-selection-during-composition/README.html">browser-hacks/should-suppress-selection-during-composition</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./constants/README.html">constants</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/find-diff/README.html">parse-change/find-diff</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/get-preferred-diff-position/README.html">parse-change/get-preferred-diff-position</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/handle-selection-only-change/README.html">parse-change/handle-selection-only-change</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/is-mark-change/README.html">parse-change/is-mark-change</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/looks-like-backspace/README.html">parse-change/looks-like-backspace</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/looks-like-backspace-key/README.html">parse-change/looks-like-backspace-key</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/looks-like-enter-key/README.html">parse-change/looks-like-enter-key</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/needs-selection-overwrite-adjustment/README.html">parse-change/needs-selection-overwrite-adjustment</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/parse-between/README.html">parse-change/parse-between</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/resolve-selection/README.html">parse-change/resolve-selection</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/should-adjust-change-end-to-selection/README.html">parse-change/should-adjust-change-end-to-selection</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/should-adjust-change-start-to-selection/README.html">parse-change/should-adjust-change-start-to-selection</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./parse-change/should-create-type-over-change/README.html">parse-change/should-create-type-over-change</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./read-dom-change/README.html">read-dom-change</a></p></td><td><p><strong>Remarks</strong></p><p>All referencing and parsing is done with the start-of-operation selection and document, since that&#39;s the one that the DOM represents. If any changes came in the meantime, the modification is mapped over those before it is applied.</p></td></tr><tr><td><p><a href="./types/dom-change/DocumentChange/README.html">types/dom-change/DocumentChange</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./types/dom-change/DOMPositionInfo/README.html">types/dom-change/DOMPositionInfo</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./types/dom-change/MarkChangeInfo/README.html">types/dom-change/MarkChangeInfo</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./types/dom-change/ParseBetweenResult/README.html">types/dom-change/ParseBetweenResult</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./util/key-event/README.html">util/key-event</a></p></td><td><p>‐</p></td></tr></tbody></table>`,38)])])}const g=s(n,[["render",r]]);export{k as __pageData,g as default};
