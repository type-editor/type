import{_ as t,o as a,c as i,ak as n}from"./chunks/framework.EVMbD_FN.js";const c=JSON.parse('{"title":"Function: findDiff()","description":"","frontmatter":{},"headers":[],"relativePath":"@type-editor/dom-change-util/parse-change/find-diff/functions/findDiff.md","filePath":"@type-editor/dom-change-util/parse-change/find-diff/functions/findDiff.md"}'),s={name:"@type-editor/dom-change-util/parse-change/find-diff/functions/findDiff.md"};function r(o,e,d,h,p,f){return a(),i("div",null,[...e[0]||(e[0]=[n(`<p><a href="./../../../../../README.html"><strong>Type Editor</strong></a></p><hr><p><a href="./../../../../../">Type Editor</a> / <a href="./../../../README.html">@type-editor/dom-change-util</a> / <a href="./../README.html">parse-change/find-diff</a> / findDiff</p><h1 id="function-finddiff" tabindex="-1">Function: findDiff() <a class="header-anchor" href="#function-finddiff" aria-label="Permalink to “Function: findDiff()”">​</a></h1><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> findDiff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  oldFragment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  newFragment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  preferredPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  preferredSide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DocumentChange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Defined in: <a href="https://github.com/type-editor/type/blob/8f2401b36ac56cc1b338db1b9300f2d4f10eb04a/packages/dom-change-util/src/dom-change/parse-change/find-diff.ts#L51" target="_blank" rel="noreferrer">parse-change/find-diff.ts:51</a></p><p>Finds the difference between two fragments and returns the positions of the change.</p><p>This is the core diff algorithm for detecting what changed between the old document and the parsed DOM content. It uses ProseMirror&#39;s built-in diff methods and then applies sophisticated adjustments to handle edge cases.</p><p><strong>Algorithm Steps:</strong></p><ol><li><strong>Find diff start:</strong> Use Fragment.findDiffStart to find where content diverges</li><li><strong>Find diff end:</strong> Use Fragment.findDiffEnd to find where content converges again</li><li><strong>Adjust for preferred position:</strong> When the user&#39;s cursor is known, bias the diff boundaries toward that position for more intuitive change detection</li><li><strong>Handle surrogate pairs:</strong> Unicode characters outside BMP use surrogate pairs; ensure we don&#39;t split them when adjusting boundaries</li></ol><p><strong>Preferred Position Handling:</strong></p><p>When preferredPos is between the diff boundaries, the algorithm tries to move the boundaries to include the cursor position. This ensures changes appear to happen at the cursor rather than at arbitrary matching text positions.</p><p>For example, if typing &quot;a&quot; in &quot;bat&quot; where cursor is after &quot;b&quot;, prefer detecting the change as &quot;b|at&quot; → &quot;ba|at&quot; rather than &quot;ba|t&quot; → &quot;ba|at&quot;.</p><p><strong>Surrogate Pair Handling:</strong></p><p>UTF-16 surrogate pairs (used for emoji and other non-BMP characters) must not be split. When adjusting boundaries, if we land in the middle of a surrogate pair, adjust by one position to keep the pair intact.</p><h2 id="parameters" tabindex="-1">Parameters <a class="header-anchor" href="#parameters" aria-label="Permalink to “Parameters”">​</a></h2><table tabindex="0"><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>oldFragment</code></td><td><code>Fragment</code></td><td>The original fragment from the current document</td></tr><tr><td><code>newFragment</code></td><td><code>Fragment</code></td><td>The new fragment from the parsed DOM</td></tr><tr><td><code>pos</code></td><td><code>number</code></td><td>The base position offset in the document where these fragments start</td></tr><tr><td><code>preferredPos</code></td><td><code>number</code></td><td>The preferred cursor position to anchor the diff around</td></tr><tr><td><code>preferredSide</code></td><td><code>&quot;start&quot;</code> | <code>&quot;end&quot;</code></td><td>Whether to prefer anchoring to &#39;start&#39; or &#39;end&#39; of changes. &#39;end&#39; is preferred after backspace, &#39;start&#39; for insertions.</td></tr></tbody></table><h2 id="returns" tabindex="-1">Returns <a class="header-anchor" href="#returns" aria-label="Permalink to “Returns”">​</a></h2><p><a href="./../../../types/dom-change/DocumentChange/interfaces/DocumentChange.html"><code>DocumentChange</code></a></p><p>A DocumentChange object with start, endA (old end), and endB (new end) positions, or null if the fragments are identical</p><h2 id="see" tabindex="-1">See <a class="header-anchor" href="#see" aria-label="Permalink to “See”">​</a></h2><ul><li><a href="./../../../types/dom-change/DocumentChange/interfaces/DocumentChange.html">DocumentChange</a> for return type structure</li><li>getPreferredDiffPosition for how preferred position is determined</li></ul><h2 id="remarks" tabindex="-1">Remarks <a class="header-anchor" href="#remarks" aria-label="Permalink to “Remarks”">​</a></h2><p>Includes special handling for Unicode surrogate pairs (e.g., emoji)</p>`,24)])])}const g=t(s,[["render",r]]);export{c as __pageData,g as default};
