import{_ as s,o as e,c as a,ak as t}from"./chunks/framework.EVMbD_FN.js";const c=JSON.parse('{"title":"@type-editor/selection-util","description":"","frontmatter":{},"headers":[],"relativePath":"@type-editor/selection-util/README.md","filePath":"@type-editor/selection-util/README.md"}'),n={name:"@type-editor/selection-util/README.md"};function l(h,i,o,p,r,k){return e(),a("div",null,[...i[0]||(i[0]=[t(`<p><a href="./../../README.html"><strong>Type Editor</strong></a></p><hr><p><a href="./../../">Type Editor</a> / @type-editor/selection-util</p><h1 id="type-editor-selection-util" tabindex="-1">@type-editor/selection-util <a class="header-anchor" href="#type-editor-selection-util" aria-label="Permalink to “@type-editor/selection-util”">​</a></h1><p>This module was part of the <code>ProseMirror view module</code>.</p><p>Selection utility functions for the Type Editor.</p><p>This module provides utility functions for handling the synchronization and conversion between DOM selections and ProseMirror selections. It handles browser-specific quirks, Shadow DOM support, and various edge cases that arise when working with rich text selections.</p><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to “Installation”">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @type-editor/selection-util</span></span></code></pre></div><h2 id="api-reference" tabindex="-1">API Reference <a class="header-anchor" href="#api-reference" aria-label="Permalink to “API Reference”">​</a></h2><h3 id="selection-conversion" tabindex="-1">Selection Conversion <a class="header-anchor" href="#selection-conversion" aria-label="Permalink to “Selection Conversion”">​</a></h3><h4 id="selectionfromdom-view-pmeditorview-origin-string-null-pmselection-null" tabindex="-1"><code>selectionFromDOM(view: PmEditorView, origin?: string | null): PmSelection | null</code> <a class="header-anchor" href="#selectionfromdom-view-pmeditorview-origin-string-null-pmselection-null" aria-label="Permalink to “selectionFromDOM(view: PmEditorView, origin?: string | null): PmSelection | null”">​</a></h4><p>Converts a DOM selection to a ProseMirror Selection.</p><p>This function reads the current browser selection and translates it into a ProseMirror selection that can be used with the editor state. It handles various edge cases including collapsed selections, node selections, and multi-range selections.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { selectionFromDOM } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/selection-util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Convert the current browser selection to a ProseMirror selection</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectionFromDOM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (selection) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> view.state.tr.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSelection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(selection);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  view.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Pass origin for bias calculation (e.g., from pointer events)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pointerSelection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectionFromDOM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pointer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h4 id="selectiontodom-view-pmeditorview-force-boolean-void" tabindex="-1"><code>selectionToDOM(view: PmEditorView, force?: boolean): void</code> <a class="header-anchor" href="#selectiontodom-view-pmeditorview-force-boolean-void" aria-label="Permalink to “selectionToDOM(view: PmEditorView, force?: boolean): void”">​</a></h4><p>Synchronizes the ProseMirror selection to the DOM.</p><p>This function updates the browser&#39;s selection to match the current ProseMirror selection state. It handles various edge cases including:</p><ul><li>Node selections</li><li>Delayed drag selections in Chrome</li><li>Broken selection behavior in Safari/older Chrome</li><li>Cursor wrappers for special cases</li><li>Selection visibility</li></ul><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { selectionToDOM } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/selection-util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Sync the current ProseMirror selection to the DOM</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectionToDOM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Force sync even if it appears unnecessary</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectionToDOM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="selection-creation" tabindex="-1">Selection Creation <a class="header-anchor" href="#selection-creation" aria-label="Permalink to “Selection Creation”">​</a></h3><h4 id="selectionbetween-view-pmeditorview-anchor-resolvedpos-head-resolvedpos-bias-number-pmselection" tabindex="-1"><code>selectionBetween(view: PmEditorView, $anchor: ResolvedPos, $head: ResolvedPos, bias?: number): PmSelection</code> <a class="header-anchor" href="#selectionbetween-view-pmeditorview-anchor-resolvedpos-head-resolvedpos-bias-number-pmselection" aria-label="Permalink to “selectionBetween(view: PmEditorView, $anchor: ResolvedPos, $head: ResolvedPos, bias?: number): PmSelection”">​</a></h4><p>Creates a selection between two resolved positions.</p><p>This function first checks if any plugins provide a custom <code>createSelectionBetween</code> method. If not, it falls back to creating a standard text selection. This allows plugins to implement custom selection types (e.g., table cell selections).</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { selectionBetween } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/selection-util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> doc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> view.state.doc;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $anchor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $head</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create a selection between two positions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectionBetween</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view, $anchor, $head);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// With forward bias</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> forwardSelection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectionBetween</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view, $anchor, $head, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// With backward bias</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> backwardSelection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectionBetween</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view, $anchor, $head, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="selection-state-checks" tabindex="-1">Selection State Checks <a class="header-anchor" href="#selection-state-checks" aria-label="Permalink to “Selection State Checks”">​</a></h3><h4 id="hasfocusandselection-view-pmeditorview-boolean" tabindex="-1"><code>hasFocusAndSelection(view: PmEditorView): boolean</code> <a class="header-anchor" href="#hasfocusandselection-view-pmeditorview-boolean" aria-label="Permalink to “hasFocusAndSelection(view: PmEditorView): boolean”">​</a></h4><p>Checks if the editor both has focus and contains a selection.</p><p>For editable views, this requires the view to have focus. For all views, this checks if a valid selection exists within the editor.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { hasFocusAndSelection } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/selection-util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hasFocusAndSelection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Safe to perform selection-dependent operations</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Editor has focus and selection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="selectioncollapsed-domsel-domselectionrange-boolean" tabindex="-1"><code>selectionCollapsed(domSel: DOMSelectionRange): boolean</code> <a class="header-anchor" href="#selectioncollapsed-domsel-domselectionrange-boolean" aria-label="Permalink to “selectionCollapsed(domSel: DOMSelectionRange): boolean”">​</a></h4><p>Checks if a DOM selection is collapsed (has no range).</p><p>This function works around a Chrome issue where <code>isCollapsed</code> inappropriately returns true in Shadow DOM. It uses position comparison to properly detect collapsed selections.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { selectionCollapsed } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/selection-util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> domSelection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> view.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">domSelectionRange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">selectionCollapsed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(domSelection)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Selection is a caret (collapsed)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Selection has a range&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="anchorinrightplace-view-pmeditorview-boolean" tabindex="-1"><code>anchorInRightPlace(view: PmEditorView): boolean</code> <a class="header-anchor" href="#anchorinrightplace-view-pmeditorview-boolean" aria-label="Permalink to “anchorInRightPlace(view: PmEditorView): boolean”">​</a></h4><p>Checks if the DOM selection&#39;s anchor is at the expected position.</p><p>This compares the ProseMirror selection&#39;s anchor position with the actual DOM selection&#39;s anchor position to verify they are equivalent. This is useful for detecting if the DOM selection has drifted from the expected state.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { anchorInRightPlace } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/selection-util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">anchorInRightPlace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // DOM selection has drifted, may need to resync</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  selectionToDOM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="caret-position" tabindex="-1">Caret Position <a class="header-anchor" href="#caret-position" aria-label="Permalink to “Caret Position”">​</a></h3><h4 id="caretfrompoint-doc-document-x-number-y-number-node-node-offset-number-undefined" tabindex="-1"><code>caretFromPoint(doc: Document, x: number, y: number): { node: Node, offset: number } | undefined</code> <a class="header-anchor" href="#caretfrompoint-doc-document-x-number-y-number-node-node-offset-number-undefined" aria-label="Permalink to “caretFromPoint(doc: Document, x: number, y: number): { node: Node, offset: number } | undefined”">​</a></h4><p>Gets the caret position from a point in the document.</p><p>This function tries browser-specific methods to determine the DOM position (node and offset) at the given screen coordinates. It handles both Firefox&#39;s <code>caretPositionFromPoint</code> and Chrome/Safari&#39;s <code>caretRangeFromPoint</code>.</p><p>The offset is clipped to the node size to handle edge cases where browsers might return invalid offsets (e.g., text offsets into <code>&lt;input&gt;</code> nodes).</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { caretFromPoint } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/selection-util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;click&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> position</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> caretFromPoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(document, event.clientX, event.clientY);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (position) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Clicked at node:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, position.node);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Offset:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, position.offset);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="node-selection-sync" tabindex="-1">Node Selection Sync <a class="header-anchor" href="#node-selection-sync" aria-label="Permalink to “Node Selection Sync”">​</a></h3><h4 id="syncnodeselection-view-pmeditorview-sel-pmselection-void" tabindex="-1"><code>syncNodeSelection(view: PmEditorView, sel: PmSelection): void</code> <a class="header-anchor" href="#syncnodeselection-view-pmeditorview-sel-pmselection-void" aria-label="Permalink to “syncNodeSelection(view: PmEditorView, sel: PmSelection): void”">​</a></h4><p>Synchronizes node selection state between ProseMirror and the DOM.</p><p>When a node is selected (as opposed to text selection), this function ensures that the appropriate view descriptor is marked as selected, and any previously selected node is deselected. This allows node views to apply custom styling or behavior when selected.</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { syncNodeSelection } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/selection-util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Typically called internally by selectionToDOM, but can be used directly</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">syncNodeSelection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(view, view.state.selection);</span></span></code></pre></div><h2 id="browser-compatibility" tabindex="-1">Browser Compatibility <a class="header-anchor" href="#browser-compatibility" aria-label="Permalink to “Browser Compatibility”">​</a></h2><p>This module handles several browser-specific quirks:</p><ul><li><strong>Chrome</strong>: Handles delayed drag selection sync to prevent flickering</li><li><strong>Chrome Shadow DOM</strong>: Works around <code>isCollapsed</code> returning incorrect values in Shadow DOM</li><li><strong>Safari/older Chrome</strong>: Works around issues with selections between non-editable block nodes</li><li><strong>Firefox</strong>: Uses <code>caretPositionFromPoint</code> API for caret position detection</li><li><strong>All browsers</strong>: Falls back to <code>caretRangeFromPoint</code> when Firefox API is unavailable</li></ul><h2 id="license" tabindex="-1">License <a class="header-anchor" href="#license" aria-label="Permalink to “License”">​</a></h2><p>MIT</p><h2 id="modules" tabindex="-1">Modules <a class="header-anchor" href="#modules" aria-label="Permalink to “Modules”">​</a></h2><table><thead><tr><th>Module</th><th>Description</th></tr></thead><tbody><tr><td><p><a href="./anchor-in-right-place/README.html">anchor-in-right-place</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./caret-from-point/README.html">caret-from-point</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./has-focus-and-selection/README.html">has-focus-and-selection</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./has-selection/README.html">has-selection</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./selection-between/README.html">selection-between</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./selection-collapsed/README.html">selection-collapsed</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./selection-from-dom/README.html">selection-from-dom</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./selection-to-dom/README.html">selection-to-dom</a></p></td><td><p>‐</p></td></tr><tr><td><p><a href="./sync-node-selection/README.html">sync-node-selection</a></p></td><td><p>‐</p></td></tr></tbody></table>`,56)])])}const E=s(n,[["render",l]]);export{c as __pageData,E as default};
