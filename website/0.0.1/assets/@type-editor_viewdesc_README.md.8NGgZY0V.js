import{_ as i,o as a,c as e,ak as n}from"./chunks/framework.EVMbD_FN.js";const c=JSON.parse('{"title":"@type-editor/viewdesc","description":"","frontmatter":{},"headers":[],"relativePath":"@type-editor/viewdesc/README.md","filePath":"@type-editor/viewdesc/README.md"}'),t={name:"@type-editor/viewdesc/README.md"};function l(h,s,p,k,r,d){return a(),e("div",null,[...s[0]||(s[0]=[n(`<p><a href="./../../README.html"><strong>Type Editor</strong></a></p><hr><p><a href="./../../">Type Editor</a> / @type-editor/viewdesc</p><h1 id="type-editor-viewdesc" tabindex="-1">@type-editor/viewdesc <a class="header-anchor" href="#type-editor-viewdesc" aria-label="Permalink to ‚Äú@type-editor/viewdesc‚Äù">‚Äã</a></h1><p>A refactored version of ProseMirror&#39;s view description system, providing the core rendering engine that maintains a parallel tree structure between the document model and the DOM representation.</p><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to ‚ÄúInstallation‚Äù">‚Äã</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @type-editor/viewdesc</span></span></code></pre></div><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to ‚ÄúOverview‚Äù">‚Äã</a></h2><p>The ViewDesc (View Description) system is the internal rendering layer that powers the Type Editor view. It creates and maintains a tree of descriptor objects that:</p><ul><li><strong>Mirror the document structure</strong>: Each document node has a corresponding ViewDesc</li><li><strong>Manage DOM nodes</strong>: Create, update, and destroy DOM elements efficiently</li><li><strong>Apply decorations</strong>: Render visual enhancements without modifying the document</li><li><strong>Map positions</strong>: Convert between document positions and DOM coordinates</li><li><strong>Handle updates</strong>: Incrementally update the DOM when the document changes</li><li><strong>Support custom rendering</strong>: Allow developers to override node rendering</li></ul><p>ViewDesc operates as an abstraction layer between the editor&#39;s document state and the browser&#39;s DOM, enabling efficient updates and sophisticated rendering capabilities.</p><h2 id="core-concepts" tabindex="-1">Core Concepts <a class="header-anchor" href="#core-concepts" aria-label="Permalink to ‚ÄúCore Concepts‚Äù">‚Äã</a></h2><h3 id="the-parallel-tree-structure" tabindex="-1">The Parallel Tree Structure <a class="header-anchor" href="#the-parallel-tree-structure" aria-label="Permalink to ‚ÄúThe Parallel Tree Structure‚Äù">‚Äã</a></h3><p>Type Editor maintains two parallel trees:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Document Tree (Model)          ViewDesc Tree                  DOM Tree</span></span>
<span class="line"><span>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ          ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span>
<span class="line"><span>    doc                            DocViewDesc                   &lt;div&gt;</span></span>
<span class="line"><span>     ‚îÇ                                  ‚îÇ                          ‚îÇ</span></span>
<span class="line"><span>     ‚îú‚îÄ paragraph                   NodeViewDesc               &lt;p&gt;</span></span>
<span class="line"><span>     ‚îÇ   ‚îî‚îÄ &quot;Hello&quot;                 ‚îî‚îÄ TextViewDesc            ‚îî‚îÄ &quot;Hello&quot;</span></span>
<span class="line"><span>     ‚îÇ</span></span>
<span class="line"><span>     ‚îú‚îÄ blockquote                  NodeViewDesc               &lt;blockquote&gt;</span></span>
<span class="line"><span>     ‚îÇ   ‚îî‚îÄ paragraph               ‚îî‚îÄ NodeViewDesc            ‚îî‚îÄ &lt;p&gt;</span></span>
<span class="line"><span>     ‚îÇ       ‚îî‚îÄ &quot;World&quot;                 ‚îî‚îÄ TextViewDesc            ‚îî‚îÄ &quot;World&quot;</span></span></code></pre></div><p>Each ViewDesc maintains:</p><ul><li>References to its DOM node(s)</li><li>Knowledge of its document position</li><li>Information about decorations</li><li>Links to parent and child ViewDescs</li></ul><h3 id="viewdesc-types" tabindex="-1">ViewDesc Types <a class="header-anchor" href="#viewdesc-types" aria-label="Permalink to ‚ÄúViewDesc Types‚Äù">‚Äã</a></h3><p>The system includes several specialized ViewDesc types:</p><ul><li><strong>NodeViewDesc</strong>: Represents document nodes (paragraphs, headings, lists, etc.)</li><li><strong>TextViewDesc</strong>: Represents text content within nodes</li><li><strong>MarkViewDesc</strong>: Represents inline marks (bold, italic, links)</li><li><strong>WidgetViewDesc</strong>: Represents decoration widgets (placeholders, UI elements)</li><li><strong>CustomNodeViewDesc</strong>: Represents user-defined custom node views</li><li><strong>CompositionViewDesc</strong>: Handles IME composition for complex text input</li><li><strong>TrailingHackViewDesc</strong>: Browser-specific compatibility fixes</li></ul><h2 id="key-components" tabindex="-1">Key Components <a class="header-anchor" href="#key-components" aria-label="Permalink to ‚ÄúKey Components‚Äù">‚Äã</a></h2><h3 id="viewdesc-base-class" tabindex="-1">ViewDesc (Base Class) <a class="header-anchor" href="#viewdesc-base-class" aria-label="Permalink to ‚ÄúViewDesc (Base Class)‚Äù">‚Äã</a></h3><p>The foundation class providing core functionality:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ViewDesc } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/viewdesc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ViewDesc properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewDesc.dom; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The DOM node</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewDesc.contentDOM; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Where children are rendered</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewDesc.parent; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Parent ViewDesc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewDesc.children; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Child ViewDescs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewDesc.dirty; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Dirty state tracking</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewDesc.node; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Associated ProseMirror node</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Position mapping</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">posBeforeChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(childDesc);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> domPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">domFromPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> docPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localPosFromDOM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(domNode, offset, bias);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Lifecycle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">markDirty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(from, to);</span></span></code></pre></div><h3 id="nodeviewdesc" tabindex="-1">NodeViewDesc <a class="header-anchor" href="#nodeviewdesc" aria-label="Permalink to ‚ÄúNodeViewDesc‚Äù">‚Äã</a></h3><p>Represents actual document nodes with full support for decorations:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { NodeViewDesc } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/viewdesc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// NodeViewDesc properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nodeViewDesc.node; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The ProseMirror node</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nodeViewDesc.outerDeco; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Decorations wrapping the node</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nodeViewDesc.innerDeco; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Decorations inside the node</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nodeViewDesc.nodeDOM; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The node&#39;s primary DOM element</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nodeViewDesc.size; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node size in the document</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nodeViewDesc.border; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Border size (0 for leaves, 1 for blocks)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node matching for efficient updates</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> matches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nodeViewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">matchesNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node, outerDeco, innerDeco);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Apply decorations</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> decoratedDOM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NodeViewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">applyOuterDeco</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dom, decorations, node);</span></span></code></pre></div><h3 id="textviewdesc" tabindex="-1">TextViewDesc <a class="header-anchor" href="#textviewdesc" aria-label="Permalink to ‚ÄúTextViewDesc‚Äù">‚Äã</a></h3><p>Represents text nodes with special handling for text content:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { TextViewDesc } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/viewdesc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// TextViewDesc wraps text DOM nodes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> textDesc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TextViewDesc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parent, node, outerDeco, innerDeco, dom);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Efficiently updates text content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">textDesc.node </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newTextNode;</span></span></code></pre></div><h3 id="markviewdesc" tabindex="-1">MarkViewDesc <a class="header-anchor" href="#markviewdesc" aria-label="Permalink to ‚ÄúMarkViewDesc‚Äù">‚Äã</a></h3><p>Represents inline marks that wrap text or other content:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { MarkViewDesc } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/viewdesc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// MarkViewDesc wraps content with mark styling</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> markDesc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MarkViewDesc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parent, mark, dom, contentDOM);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Marks are layered - a bold italic link would have three MarkViewDescs</span></span></code></pre></div><h3 id="customnodeviewdesc" tabindex="-1">CustomNodeViewDesc <a class="header-anchor" href="#customnodeviewdesc" aria-label="Permalink to ‚ÄúCustomNodeViewDesc‚Äù">‚Äã</a></h3><p>Used when developers provide custom node views:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { CustomNodeViewDesc } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/viewdesc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Created automatically when using custom node views</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> customDesc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomNodeViewDesc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  parent,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  node,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  outerDeco,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  innerDeco,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  dom,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  contentDOM,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  nodeDOM,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  nodeView, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The custom node view object</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  view,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  getPos,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="working-with-viewdescs" tabindex="-1">Working with ViewDescs <a class="header-anchor" href="#working-with-viewdescs" aria-label="Permalink to ‚ÄúWorking with ViewDescs‚Äù">‚Äã</a></h2><h3 id="creating-the-view-tree" tabindex="-1">Creating the View Tree <a class="header-anchor" href="#creating-the-view-tree" aria-label="Permalink to ‚ÄúCreating the View Tree‚Äù">‚Äã</a></h3><p>ViewDescs are typically created internally by the editor view:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { docViewDesc } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/viewdesc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Creates the root ViewDesc tree</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> docView</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> docViewDesc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  state.doc, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Document</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  outerDeco, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Outer decorations</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  innerDeco, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Inner decorations</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  containerDOM, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Container element</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  editorView, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// View instance</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="updating-viewdescs" tabindex="-1">Updating ViewDescs <a class="header-anchor" href="#updating-viewdescs" aria-label="Permalink to ‚ÄúUpdating ViewDescs‚Äù">‚Äã</a></h3><p>The <code>ViewDescUpdater</code> handles incremental updates:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ViewDescUpdater } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/viewdesc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Attempts to update the existing tree</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> updated</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ViewDescUpdater.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  viewDesc,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  editorView,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  newNode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  outerDeco,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  innerDeco,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">updated) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Full redraw needed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  viewDesc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createNewViewDesc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="position-mapping" tabindex="-1">Position Mapping <a class="header-anchor" href="#position-mapping" aria-label="Permalink to ‚ÄúPosition Mapping‚Äù">‚Äã</a></h3><p>Convert between document positions and DOM coordinates:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Document position ‚Üí DOM coordinates</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">domFromPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Returns the DOM node and offset at document position 15</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// DOM coordinates ‚Üí Document position</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">posFromDOM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(domNode, domOffset, bias);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Returns the document position for the given DOM location</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Position before a child</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">posBeforeChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(childViewDesc);</span></span></code></pre></div><h3 id="utility-functions" tabindex="-1">Utility Functions <a class="header-anchor" href="#utility-functions" aria-label="Permalink to ‚ÄúUtility Functions‚Äù">‚Äã</a></h3><p>The <code>ViewDescUtil</code> provides helper functions:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ViewDescUtil } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/viewdesc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Find ViewDesc by DOM node</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> desc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ViewDescUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findByDOM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(domNode);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Find parent block ViewDesc</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blockDesc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ViewDescUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findParentBlock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(viewDesc);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check if ViewDesc needs update</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> needsUpdate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ViewDescUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">needsUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(viewDesc, node, deco);</span></span></code></pre></div><h2 id="advanced-usage" tabindex="-1">Advanced Usage <a class="header-anchor" href="#advanced-usage" aria-label="Permalink to ‚ÄúAdvanced Usage‚Äù">‚Äã</a></h2><h3 id="custom-node-views" tabindex="-1">Custom Node Views <a class="header-anchor" href="#custom-node-views" aria-label="Permalink to ‚ÄúCustom Node Views‚Äù">‚Äã</a></h3><p>Custom node views automatically get wrapped in <code>CustomNodeViewDesc</code>:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { EditorView } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/view&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> view</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EditorView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  nodeViews: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Custom rendering for images</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">view</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">getPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dom</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;figure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> img</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;img&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      img.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node.attrs.src;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      dom.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(img);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // CustomNodeViewDesc wraps this automatically</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { dom };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Custom rendering with content</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    callout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">view</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">getPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dom</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;div&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      dom.className </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;callout&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contentDOM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;div&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      contentDOM.className </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;callout-content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      dom.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(contentDOM);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { dom, contentDOM };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="decoration-rendering" tabindex="-1">Decoration Rendering <a class="header-anchor" href="#decoration-rendering" aria-label="Permalink to ‚ÄúDecoration Rendering‚Äù">‚Äã</a></h3><p>ViewDescs apply decorations during rendering:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Inline decorations add attributes to text</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> inlineDeco</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Decoration.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">inline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;highlight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  style: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;background: yellow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// MarkViewDesc or TextViewDesc applies these attributes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Node decorations wrap entire nodes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nodeDeco</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Decoration.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">45</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;selected-node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// NodeViewDesc wraps the node with decoration elements</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Widget decorations insert DOM elements</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> widgetDeco</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Decoration.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">widget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> el</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;span&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  el.textContent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;üìç&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> el;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// WidgetViewDesc manages the widget DOM</span></span></code></pre></div><h3 id="dirty-state-tracking" tabindex="-1">Dirty State Tracking <a class="header-anchor" href="#dirty-state-tracking" aria-label="Permalink to ‚ÄúDirty State Tracking‚Äù">‚Äã</a></h3><p>ViewDescs track what needs updating:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ViewDirtyState } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@type-editor/viewdesc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Dirty states</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ViewDirtyState.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NOT_DIRTY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// No update needed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ViewDirtyState.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CHILD_DIRTY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Children need update</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ViewDirtyState.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTENT_DIRTY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Content needs update</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ViewDirtyState.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_DIRTY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Entire node needs update</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Mark a range as dirty</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">markDirty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(from, to);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Check if ViewDesc is dirty</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (viewDesc.dirty </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ViewDirtyState.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NOT_DIRTY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Needs update</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="position-and-offset-calculations" tabindex="-1">Position and Offset Calculations <a class="header-anchor" href="#position-and-offset-calculations" aria-label="Permalink to ‚ÄúPosition and Offset Calculations‚Äù">‚Äã</a></h3><p>Working with positions in the ViewDesc tree:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get position before a specific child</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> posBefore</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">posBeforeChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(child);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get position after a child</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> posAfter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> posBefore </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> child.size;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Find child at a position</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> child</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">childAfter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pos);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Local position from DOM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> localPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewDesc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localPosFromDOM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(domNode, offset, bias);</span></span></code></pre></div><h2 id="performance-considerations" tabindex="-1">Performance Considerations <a class="header-anchor" href="#performance-considerations" aria-label="Permalink to ‚ÄúPerformance Considerations‚Äù">‚Äã</a></h2><ol><li><strong>Incremental updates</strong>: ViewDesc enables efficient partial DOM updates instead of full rerenders</li><li><strong>Dirty tracking</strong>: Only updates parts marked as dirty</li><li><strong>Node matching</strong>: Reuses existing ViewDesc nodes when possible</li><li><strong>DOM node reuse</strong>: Keeps DOM nodes stable across updates when content hasn&#39;t changed</li><li><strong>Position caching</strong>: Maintains position information for fast lookups</li><li><strong>Minimal DOM operations</strong>: Batches and minimizes DOM changes</li></ol><h2 id="internal-architecture" tabindex="-1">Internal Architecture <a class="header-anchor" href="#internal-architecture" aria-label="Permalink to ‚ÄúInternal Architecture‚Äù">‚Äã</a></h2><p>The ViewDesc system consists of several interconnected components:</p><ul><li><strong>ViewDesc</strong>: Base class with core functionality</li><li><strong>ViewDescFactory</strong>: Creates appropriate ViewDesc instances</li><li><strong>ViewDescUpdater</strong>: Handles incremental updates</li><li><strong>ViewDescUtil</strong>: Utility functions for working with ViewDescs</li><li><strong>ViewTreeUpdater</strong>: Manages tree-level updates</li><li><strong>OuterDecoLevel</strong>: Manages decoration wrapper levels</li></ul><p>These components work together to provide efficient, incremental DOM rendering while maintaining the connection between the document model and the visual representation.</p><h2 id="api-reference" tabindex="-1">API Reference <a class="header-anchor" href="#api-reference" aria-label="Permalink to ‚ÄúAPI Reference‚Äù">‚Äã</a></h2><h3 id="viewdesc" tabindex="-1">ViewDesc <a class="header-anchor" href="#viewdesc" aria-label="Permalink to ‚ÄúViewDesc‚Äù">‚Äã</a></h3><p>Base class methods and properties:</p><p><strong>Properties:</strong></p><ul><li><code>dom: Node</code> - The DOM node</li><li><code>contentDOM: HTMLElement | null</code> - Container for child content</li><li><code>parent: ViewDesc | undefined</code> - Parent ViewDesc</li><li><code>children: ViewDesc[]</code> - Child ViewDescs</li><li><code>dirty: ViewDirtyState</code> - Dirty state</li><li><code>node: Node | null</code> - Associated ProseMirror node</li></ul><p><strong>Methods:</strong></p><ul><li><code>destroy(): void</code> - Clean up resources</li><li><code>markDirty(from: number, to: number): void</code> - Mark range as dirty</li><li><code>domFromPos(pos: number, side: number): DOMPosition</code> - Map position to DOM</li><li><code>localPosFromDOM(node: Node, offset: number, bias: number): number</code> - Map DOM to position</li><li><code>posBeforeChild(child: ViewDesc): number</code> - Get position before child</li></ul><h3 id="nodeviewdesc-1" tabindex="-1">NodeViewDesc <a class="header-anchor" href="#nodeviewdesc-1" aria-label="Permalink to ‚ÄúNodeViewDesc‚Äù">‚Äã</a></h3><p>Extends ViewDesc with node-specific functionality:</p><p><strong>Additional Properties:</strong></p><ul><li><code>outerDeco: Decoration[] | null</code> - Outer decorations</li><li><code>innerDeco: DecorationSource | null</code> - Inner decorations</li><li><code>nodeDOM: Node</code> - The node&#39;s DOM element</li><li><code>size: number</code> - Node size</li><li><code>border: number</code> - Border size</li><li><code>domAtom: boolean</code> - Whether node is a DOM atom</li></ul><p><strong>Static Methods:</strong></p><ul><li><code>applyOuterDeco(dom: Node, deco: Decoration[], node: Node): Node</code> - Apply decorations to DOM</li></ul><h3 id="viewdescupdater" tabindex="-1">ViewDescUpdater <a class="header-anchor" href="#viewdescupdater" aria-label="Permalink to ‚ÄúViewDescUpdater‚Äù">‚Äã</a></h3><p>Static methods for updating ViewDescs:</p><ul><li><code>update(viewDesc: ViewDesc, view: EditorView, node: Node, outerDeco, innerDeco): boolean</code> - Update ViewDesc</li><li><code>updateChildren(viewDesc: ViewDesc, view: EditorView, pos: number): void</code> - Update children</li></ul><h3 id="viewdescutil" tabindex="-1">ViewDescUtil <a class="header-anchor" href="#viewdescutil" aria-label="Permalink to ‚ÄúViewDescUtil‚Äù">‚Äã</a></h3><p>Utility functions:</p><ul><li><code>findByDOM(dom: Node): ViewDesc | undefined</code> - Find ViewDesc by DOM node</li><li>Various helper functions for ViewDesc manipulation</li></ul><h2 id="compatibility" tabindex="-1">Compatibility <a class="header-anchor" href="#compatibility" aria-label="Permalink to ‚ÄúCompatibility‚Äù">‚Äã</a></h2><p>This module is a refactored version of ProseMirror&#39;s internal view description system. While the core concepts remain the same, the API is restructured and improved with TypeScript types. For full ProseMirror compatibility, use the compatibility layer packages.</p><h2 id="related-modules" tabindex="-1">Related Modules <a class="header-anchor" href="#related-modules" aria-label="Permalink to ‚ÄúRelated Modules‚Äù">‚Äã</a></h2><ul><li><code>@type-editor/view</code>: The editor view that uses ViewDesc for rendering</li><li><code>@type-editor/decoration</code>: Decoration system that ViewDesc renders</li><li><code>@type-editor/model</code>: Document model that ViewDesc represents</li><li><code>@type-editor/dom-util</code>: DOM utility functions used by ViewDesc</li><li><code>@type-editor/transform</code>: Position mapping used during updates</li></ul><h2 id="license" tabindex="-1">License <a class="header-anchor" href="#license" aria-label="Permalink to ‚ÄúLicense‚Äù">‚Äã</a></h2><p>MIT</p><h2 id="modules" tabindex="-1">Modules <a class="header-anchor" href="#modules" aria-label="Permalink to ‚ÄúModules‚Äù">‚Äã</a></h2><table><thead><tr><th>Module</th><th>Description</th></tr></thead><tbody><tr><td><p><a href="./AbstractViewDesc/README.html">AbstractViewDesc</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./CompositionViewDesc/README.html">CompositionViewDesc</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./CustomNodeViewDesc/README.html">CustomNodeViewDesc</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./doc-view-desc/README.html">doc-view-desc</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./MarkViewDesc/README.html">MarkViewDesc</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./NodeViewDesc/README.html">NodeViewDesc</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./OuterDecoLevel/README.html">OuterDecoLevel</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./TextViewDesc/README.html">TextViewDesc</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./TrailingHackViewDesc/README.html">TrailingHackViewDesc</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./util/replace-nodes/README.html">util/replace-nodes</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./util/same-outer-deco/README.html">util/same-outer-deco</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./ViewDesc/README.html">ViewDesc</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./ViewDescFactory/README.html">ViewDescFactory</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./ViewDescType/README.html">ViewDescType</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./ViewDescUpdater/README.html">ViewDescUpdater</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./ViewDescUtil/README.html">ViewDescUtil</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./ViewDirtyState/README.html">ViewDirtyState</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./ViewTreeUpdater/README.html">ViewTreeUpdater</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./WidgetViewDesc/README.html">WidgetViewDesc</a></p></td><td><p>‚Äê</p></td></tr></tbody></table>`,95)])])}const E=i(t,[["render",l]]);export{c as __pageData,E as default};
